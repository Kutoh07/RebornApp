<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Welcome to your new life</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    body {
      background-color: #111;
      color: #0f0;
    }
    .flash {
      font-size: 2em;
      color: #0ff;
      text-align: center;
      margin: 40px;
    }
    .progress-bar {
      width: 100%;
      background-color: #222;
      margin-top: 10px;
    }
    .progress {
      height: 20px;
      background-color: #0f0;
      width: 0%;
    }
    table {
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #0f0;
      padding: 8px;
      text-align: center;
      color: #0f0;
    }
  </style>
</head>
<body class="section">
  <div id="form-section" class="container">
    <h2 class="title has-text-success">Welcome to your new life</h2>
    <p>This app will help you use your past and your present to reborn the true you and bring yourself to know who you are and unlock the full potential of your mind</p>
    <form id="userForm">
      <div class="field">
        <label class="label">Name:</label>
        <div class="control">
          <input class="input" type="text" id="name" required />
        </div>
      </div>
      <div class="field">
        <label class="label">Age:</label>
        <div class="control">
          <div class="select">
            <select id="age" required></select>
          </div>
        </div>
      </div>
      <div class="field">
        <label class="label">Sex:</label>
        <div class="control">
          <div class="select">
            <select id="sex" required>
              <option>Man</option>
              <option>Woman</option>
            </select>
          </div>
        </div>
      </div>
      <div class="field">
        <label class="label">Level of confidence:</label>
        <div class="control">
          <div class="select">
            <select id="confidence" required>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
      </div>
      <div class="field">
        <label class="label">Your current struggle:</label>
        <div class="control">
          <textarea class="textarea" id="struggle" rows="4" required></textarea>
        </div>
      </div>
      <button class="button is-link" type="submit">Submit</button>
    </form>
  </div>

  <div id="flash-section" class="container is-hidden">
    <div class="progress-bar"><div id="progress" class="progress"></div></div>
    <div id="flash-word" class="flash"></div>
    <input class="input" type="text" id="userGuess" placeholder="What did you see?" />
    <button class="button is-success mt-2" onclick="submitGuess()">Submit Guess</button>
    <div id="feedback" class="mt-2"></div>
    <button class="button is-warning mt-2" onclick="goBack()">Return</button>
    <button id="nextBtn" class="button is-info mt-2 is-hidden" onclick="nextWord()">Next</button>
    <div id="summary" class="mt-4 is-hidden"></div>
  </div>

  <script>
    const form = document.getElementById('userForm');
    const flashSection = document.getElementById('flash-section');
    const flashWord = document.getElementById('flash-word');
    const userGuess = document.getElementById('userGuess');
    const feedback = document.getElementById('feedback');
    const nextBtn = document.getElementById('nextBtn');
    const progress = document.getElementById('progress');
    const summary = document.getElementById('summary');

    let selectedWords = [];
    let currentIndex = 0;
    let displayTime = 1500;
    let wordResults = [];

    const stopWords = [
      'the','is','in','at','which','on','and','a','an','to','of','for','with','by','as','from','that','this','these','those','it','its','be','are','was','were','has','have','had','but','or','if','then','so','such','also'
    ];

    const dictionary = {
      "struggle": "to try very hard to do something difficult",
      "emotion": "a strong feeling such as love or anger",
      "anxiety": "a feeling of worry or nervousness"
    };

    for (let i = 10; i <= 100; i++) {
      const opt = document.createElement('option');
      opt.value = i;
      opt.innerText = i;
      document.getElementById('age').appendChild(opt);
    }

    function getDisplayTime(level) {
      if (level === 'low') return 3000;
      if (level === 'medium') return 1500;
      return 500;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = document.getElementById('struggle').value;
      const level = document.getElementById('confidence').value;
      displayTime = getDisplayTime(level);

      const confidenceLimits = { low: 10, medium: 15, high: 20 };
      const maxWords = confidenceLimits[level];

      const words = text.match(/\b(\w+)\b/g).map(w => w.toLowerCase());
      const filteredWords = [...new Set(words)].filter(w => !stopWords.includes(w));

      const strongWords = filteredWords.filter(w => !/^(the|and|to|of|in|a|is|it|for|on|with|as|by|at|be|an|from|this|that)$/.test(w));

      const numberToSelect = Math.min(maxWords, Math.ceil(strongWords.length * 0.2));
      selectedWords = strongWords.sort(() => 0.5 - Math.random()).slice(0, numberToSelect);

      wordResults = [];
      currentIndex = 0;
      form.parentElement.classList.add('is-hidden');
      flashSection.classList.remove('is-hidden');
      showWord();
    });

    function goBack() {
      flashSection.classList.add('is-hidden');
      document.getElementById('form-section').classList.remove('is-hidden');
    }

    function showWord() {
      if (currentIndex >= selectedWords.length) {
        showSummary();
        return;
      }
      progress.style.width = (currentIndex / selectedWords.length * 100) + '%';
      flashWord.textContent = selectedWords[currentIndex];
      setTimeout(() => {
        flashWord.textContent = '';
        userGuess.value = '';
        userGuess.focus();
      }, displayTime);
    }

    function submitGuess() {
      const userInput = userGuess.value.trim().toLowerCase();
      const originalWord = selectedWords[currentIndex].toLowerCase();
      if (userInput === originalWord) {
        feedback.textContent = 'Correct!';
        wordResults.push({ word: originalWord, status: 'OK' });
        currentIndex++;
        setTimeout(() => {
          feedback.textContent = '';
          showWord();
        }, 1000);
      } else {
        fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${originalWord}`)
          .then(res => res.json())
          .then(data => {
            const definition = data[0]?.meanings[0]?.definitions[0]?.definition || 'Definition not found.';
            feedback.textContent = `Wrong! The word was "${originalWord}". Meaning: ${definition}`;
            wordResults.push({ word: originalWord, status: 'Not OK' });
            userGuess.disabled = true;
            nextBtn.classList.remove('is-hidden');
          })
          .catch(() => {
            feedback.textContent = `Wrong! The word was "${originalWord}". Meaning: Definition not available.`;
            wordResults.push({ word: originalWord, status: 'Not OK' });
            userGuess.disabled = true;
            nextBtn.classList.remove('is-hidden');
          });
      }
    }

    function nextWord() {
      userGuess.disabled = false;
      feedback.textContent = '';
      nextBtn.classList.add('is-hidden');
      currentIndex++;
      showWord();
    }

    function showSummary() {
      flashWord.textContent = 'Session Complete!';
      userGuess.classList.add('is-hidden');
      feedback.classList.add('is-hidden');
      let html = '<table class="table is-bordered is-striped"><thead><tr><th>Word</th><th>Status</th></tr></thead><tbody>';
      wordResults.forEach(w => {
        html += `<tr><td>${w.word}</td><td>${w.status}</td></tr>`;
      });
      html += '</tbody></table>';
      summary.innerHTML = html;
      summary.classList.remove('is-hidden');
    }
  </script>
</body>
</html>
